{"title":"Encriptar valores en R","markdown":{"yaml":{"execute":{"cache":false}},"headingText":"Encriptar valores en R","containsRefs":false,"markdown":"\n\n\nAlgo muy simple para encriptar valores, la idea no es la seguridad sino que la anonimización de personas, pero aun asi se puede armar algo bien seguro con SSL.\n\n# Estrategia\n\nUsamos la librería `openssl` para el encriptado y `data.table` para ver como lo hacemos en un `data frame`\n\nLo primero que necesitamos en importar las librerías y crear la **Clave de encriptación** y un **Vector de Incialización (IV)** ambos de 16 caracteres porque si usamos menos nos sale un error.\n\nPara obtener siempre el mismo resultado al cifrar/desencriptar debes especificar un **vector de inicialización (IV)** fijo (en lugar de aleatorio).\n\nEn R con **openssl**, el proceso es así:\n\n-   **Clave**: obligatoria, secreta, constante.\n\n-   **IV**: opcional (pero recomendado), no necesariamente secreto, constante si deseas resultados reproducibles.\n\nSi defines una clave y un IV constante, siempre obtendrás el mismo texto cifrado para el mismo texto plano. Por ejemplo, algo así:\n\n-   Clave (ej.): `\"mi_clave_secreta\"`\n\n-   IV (16 bytes típicamente): `\"1234567890123456\"`\n\nEsto te permitirá cifrar y descifrar consistentemente.\n\n```{r error=TRUE}\n#| message: true\n#| warning: false\n\n# Cargar las librerías\nlibrary(data.table)\nlibrary(openssl)\nlibrary(flextable) # para mostrar las tablas en html\n\n# Crear la Key y el IV (generamos un error deliberadamente)\nkey <- charToRaw(\"olitroski\")\niv <-  charToRaw(\"miIV\")\n\n# Y encriptamos un texto para ver el error.\ntexto <- \"Mi texto a encriptar\"\n\n# Esto generará un error\naes_ctr_encrypt(charToRaw(texto), key = key, iv = iv)\n```\n\nComo vemos que para un encriptado `aes-128` hay que usar 16 caracteres o más segun la seguridad del encriptado que se quiera.\n\nEntonces hagamos lo siguiente.\n\n1.  Importar librería\n2.  Definir clave e IV\n3.  Crear un data.table para ver resultados.\n4.  Crear funcion para cifrar\n5.  Crear función para descifrar\n6.  Aplicar el cifrado y el descifrado\n\n```{r}\n#| warning: false\n\n# ---- 1. Importamos \nlibrary(openssl)\nlibrary(data.table)\n\n# ---- 2. Clave y IV fijos\nkey <- charToRaw(\"mi_clave_fija123\")\niv <-  charToRaw(\"1234567890abcdef\")\n\n# ---- 3. Crear data.table con entradas originales\ndt <- data.table('valores_encriptar' = c(\n    \"perro\",\n    \"gato\",\n    \"18745235\",\n    \"Otra clave\",\n    \"olitroski\"\n))\n\n# ver la tabla\nregulartable(dt)\n\n# ---- 4. Función para cifrar\ncifrar_aes <- Vectorize(function(texto) {\n    encrypted <- aes_ctr_encrypt(charToRaw(texto), key = key, iv = iv)\n    base64_encode(encrypted)\n})\n\n# ---- 5. Función para descifrar\ndescifrar_aes <- Vectorize(function(texto_cifrado) {\n    decrypted <- aes_ctr_decrypt(base64_decode(texto_cifrado), key = key, iv = iv)\n    rawToChar(decrypted)\n})\n\n# ---- 6. Aplicar funciones vectorizadas\ndt[, cifrar := cifrar_aes(valores_encriptar)]\ndt[, descifrar := descifrar_aes(cifrar)]\n\n# Resultado\nregulartable(dt)\n```\n\n\n","srcMarkdownNoYaml":"\n\n# Encriptar valores en R\n\nAlgo muy simple para encriptar valores, la idea no es la seguridad sino que la anonimización de personas, pero aun asi se puede armar algo bien seguro con SSL.\n\n# Estrategia\n\nUsamos la librería `openssl` para el encriptado y `data.table` para ver como lo hacemos en un `data frame`\n\nLo primero que necesitamos en importar las librerías y crear la **Clave de encriptación** y un **Vector de Incialización (IV)** ambos de 16 caracteres porque si usamos menos nos sale un error.\n\nPara obtener siempre el mismo resultado al cifrar/desencriptar debes especificar un **vector de inicialización (IV)** fijo (en lugar de aleatorio).\n\nEn R con **openssl**, el proceso es así:\n\n-   **Clave**: obligatoria, secreta, constante.\n\n-   **IV**: opcional (pero recomendado), no necesariamente secreto, constante si deseas resultados reproducibles.\n\nSi defines una clave y un IV constante, siempre obtendrás el mismo texto cifrado para el mismo texto plano. Por ejemplo, algo así:\n\n-   Clave (ej.): `\"mi_clave_secreta\"`\n\n-   IV (16 bytes típicamente): `\"1234567890123456\"`\n\nEsto te permitirá cifrar y descifrar consistentemente.\n\n```{r error=TRUE}\n#| message: true\n#| warning: false\n\n# Cargar las librerías\nlibrary(data.table)\nlibrary(openssl)\nlibrary(flextable) # para mostrar las tablas en html\n\n# Crear la Key y el IV (generamos un error deliberadamente)\nkey <- charToRaw(\"olitroski\")\niv <-  charToRaw(\"miIV\")\n\n# Y encriptamos un texto para ver el error.\ntexto <- \"Mi texto a encriptar\"\n\n# Esto generará un error\naes_ctr_encrypt(charToRaw(texto), key = key, iv = iv)\n```\n\nComo vemos que para un encriptado `aes-128` hay que usar 16 caracteres o más segun la seguridad del encriptado que se quiera.\n\nEntonces hagamos lo siguiente.\n\n1.  Importar librería\n2.  Definir clave e IV\n3.  Crear un data.table para ver resultados.\n4.  Crear funcion para cifrar\n5.  Crear función para descifrar\n6.  Aplicar el cifrado y el descifrado\n\n```{r}\n#| warning: false\n\n# ---- 1. Importamos \nlibrary(openssl)\nlibrary(data.table)\n\n# ---- 2. Clave y IV fijos\nkey <- charToRaw(\"mi_clave_fija123\")\niv <-  charToRaw(\"1234567890abcdef\")\n\n# ---- 3. Crear data.table con entradas originales\ndt <- data.table('valores_encriptar' = c(\n    \"perro\",\n    \"gato\",\n    \"18745235\",\n    \"Otra clave\",\n    \"olitroski\"\n))\n\n# ver la tabla\nregulartable(dt)\n\n# ---- 4. Función para cifrar\ncifrar_aes <- Vectorize(function(texto) {\n    encrypted <- aes_ctr_encrypt(charToRaw(texto), key = key, iv = iv)\n    base64_encode(encrypted)\n})\n\n# ---- 5. Función para descifrar\ndescifrar_aes <- Vectorize(function(texto_cifrado) {\n    decrypted <- aes_ctr_decrypt(base64_decode(texto_cifrado), key = key, iv = iv)\n    rawToChar(decrypted)\n})\n\n# ---- 6. Aplicar funciones vectorizadas\ndt[, cifrar := cifrar_aes(valores_encriptar)]\ndt[, descifrar := descifrar_aes(cifrar)]\n\n# Resultado\nregulartable(dt)\n```\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":false,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"css":["../styles.css"],"output-file":"Encriptar.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","editor":"visual","theme":"cosmo","toc-title":"Contenido"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}