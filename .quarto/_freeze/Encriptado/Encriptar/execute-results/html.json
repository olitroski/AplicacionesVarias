{
  "hash": "9996c05efade98626eeaf53f676025e5",
  "result": {
    "engine": "knitr",
    "markdown": "---\nexecute:\n  cache: false\n  freeze: false\n---\n\n\n\n\n# Encriptar valores en R\n\nAlgo muy simple para encriptar valores, la idea no es la seguridad sino que la anonimización de personas, pero aun asi se puede armar algo bien seguro con SSL.\n\n# Estrategia\n\nUsamos la librería `openssl` para el encriptado y `data.table` para ver como lo hacemos en un `data frame`\n\nLo primero que necesitamos en importar las librerías y crear la **Clave de encriptación** y un **Vector de Incialización (IV)** ambos de 16 caracteres porque si usamos menos nos sale un error.\n\nPara obtener siempre el mismo resultado al cifrar/desencriptar debes especificar un **vector de inicialización (IV)** fijo (en lugar de aleatorio).\n\nEn R con **openssl**, el proceso es así:\n\n-   **Clave**: obligatoria, secreta, constante.\n\n-   **IV**: opcional (pero recomendado), no necesariamente secreto, constante si deseas resultados reproducibles.\n\nSi defines una clave y un IV constante, siempre obtendrás el mismo texto cifrado para el mismo texto plano. Por ejemplo, algo así:\n\n-   Clave (ej.): `\"mi_clave_secreta\"`\n\n-   IV (16 bytes típicamente): `\"1234567890123456\"`\n\nEsto te permitirá cifrar y descifrar consistentemente.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargar las librerías\nlibrary(data.table)\nlibrary(openssl)\nlibrary(kableExtra) # para mostrar las tablas en html\n\n# Crear la Key y el IV (generamos un error deliberadamente)\nkey <- charToRaw(\"olitroski\")\niv <-  charToRaw(\"miIV\")\n\n# Y encriptamos un texto para ver el error.\ntexto <- \"Mi texto a encriptar\"\n\n# Esto generará un error\naes_ctr_encrypt(charToRaw(texto), key = key, iv = iv)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in aes_any(data, key, iv, TRUE, mode): key must be of length 16 (aes-128), 24 (aes-192) or 32 (aes-256)\n```\n\n\n:::\n:::\n\n\n\n\nComo vemos que para un encriptado `aes-128` hay que usar 16 caracteres o más segun la seguridad del encriptado que se quiera.\n\nEntonces hagamos lo siguiente.\n\n1.  Importar librería\n2.  Definir clave e IV\n3.  Crear un data.table para ver resultados.\n4.  Crear funcion para cifrar\n5.  Crear función para descifrar\n6.  Aplicar el cifrado y el descifrado\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ---- 1. Importamos \nlibrary(openssl)\nlibrary(data.table)\n\n# ---- 2. Clave y IV fijos\nkey <- charToRaw(\"mi_clave_fija123\")\niv <-  charToRaw(\"1234567890abcdef\")\n\n# ---- 3. Crear data.table con entradas originales\ndt <- data.table('valores_encriptar' = c(\n    \"perro\",\n    \"gato\",\n    \"18745235\",\n    \"Otra clave\",\n    \"olitroski\"\n))\n\n# ver la tabla\nkbl(dt)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> valores_encriptar </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> perro </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gato </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 18745235 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Otra clave </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> olitroski </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n# ---- 4. Función para cifrar\ncifrar_aes <- Vectorize(function(texto) {\n    encrypted <- aes_ctr_encrypt(charToRaw(texto), key = key, iv = iv)\n    base64_encode(encrypted)\n})\n\n# ---- 5. Función para descifrar\ndescifrar_aes <- Vectorize(function(texto_cifrado) {\n    decrypted <- aes_ctr_decrypt(base64_decode(texto_cifrado), key = key, iv = iv)\n    rawToChar(decrypted)\n})\n\n# ---- 6. Aplicar funciones vectorizadas\ndt[, cifrar := cifrar_aes(valores_encriptar)]\ndt[, descifrar := descifrar_aes(cifrar)]\n\n# Resultado\nkbl(dt)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> valores_encriptar </th>\n   <th style=\"text-align:left;\"> cifrar </th>\n   <th style=\"text-align:left;\"> descifrar </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> perro </td>\n   <td style=\"text-align:left;\"> p68k/yM= </td>\n   <td style=\"text-align:left;\"> perro </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gato </td>\n   <td style=\"text-align:left;\"> sKsi4g== </td>\n   <td style=\"text-align:left;\"> gato </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 18745235 </td>\n   <td style=\"text-align:left;\"> 5vJhuXlxuj0= </td>\n   <td style=\"text-align:left;\"> 18745235 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Otra clave </td>\n   <td style=\"text-align:left;\"> mL4k7Gwg5Wke5Q== </td>\n   <td style=\"text-align:left;\"> Otra clave </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> olitroski </td>\n   <td style=\"text-align:left;\"> uKY/+T4s+mMB </td>\n   <td style=\"text-align:left;\"> olitroski </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}